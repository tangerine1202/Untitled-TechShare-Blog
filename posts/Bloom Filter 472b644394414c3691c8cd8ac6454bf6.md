# Bloom Filter

Author: @Alan Huang 
Date: Nov 19, 2020
Tags: å»¶ä¼¸é–±è®€
æ€§è³ª: Tech Share

## ç‚ºä»€éº¼é€™å€‹ä¸»é¡Œå€¼å¾—åˆ†äº«

- èˆ‡æ—¥å¸¸ç”Ÿæ´»æ¯æ¯ç›¸é—œï¼Œä½†æˆ‘å€‘å»ä¸çŸ¥é“å®ƒï¼ˆå•é¡Œ or è³‡æ–™çµæ§‹æœ¬èº«ï¼‰çš„å­˜åœ¨
- æœ‰æ•ˆç‡çš„è§£æ±ºäº†ä¸€å€‹å›°é›£çš„å•é¡Œ
- ç¾åœ¨å‰›å¥½åœ¨å­¸è³‡æ–™çµæ§‹

## æƒ…å¢ƒ

1. [æŠ–éŸ³æœ‰ä¸Šå„„å€‹ä½¿ç”¨è€…å’Œä¸Šå„„å‰‡çŸ­ç‰‡ï¼Œç‚ºä»€éº¼æŠ–éŸ³å¾ä¾†ä¸æœƒå‡ºç¾é‡è¤‡çš„å½±ç‰‡ï¼Ÿ](https://medium.com/%E6%95%B8%E6%93%9A%E5%88%86%E6%9E%90%E4%B8%8D%E6%98%AF%E5%80%8B%E4%BA%8B/%E7%88%B2%E4%BB%80%E9%BA%BC%E6%8A%96%E9%9F%B3%E5%BE%9E%E4%BE%86%E6%B2%92%E6%9C%89%E9%87%8D%E8%A4%87%E5%85%A7%E5%AE%B9-%E7%84%A1%E9%97%9C%E8%B3%87%E6%96%99%E5%BA%AB-%E8%83%8C%E5%BE%8C%E7%9A%84%E6%BC%94%E7%AE%97%E6%B3%95%E6%9C%89%E5%A4%A7%E5%AD%B8%E5%95%8F-97c7c3f1c417)
2. ç•¶æˆ‘å€‘åœ¨å‰µå»º ig å¸³è™Ÿçš„æ™‚å€™ï¼Œæˆ‘å€‘è¼¸å…¥ usernameï¼Œig ä¸åˆ°ä¸€ç§’å°±å¯ä»¥å‘Šè¨´æˆ‘å€‘é€™å€‹ username æœ‰æ²’æœ‰è¢«ä½¿ç”¨éã€‚ä½† ig æœ‰ä¸Šå„„å€‹ usernameï¼Œä»–æ€éº¼é€™éº¼å¿«ç¢ºå®šçš„ï¼Ÿ

## è§£æ±ºæ–¹æ³•

è€ƒæ…®æƒ…å¢ƒ 1. ï¼Œä¸éæˆ‘å€‘ä½¿ç”¨ ig ç•¶ä¾‹å­ã€‚ 

- å»ºè¡¨è™•ç†

    æ¯å€‹ user å»ºä¸€å€‹ Listï¼Œå„²å­˜å·²ç¶“çœ‹éçš„çŸ­ç‰‡ idã€‚

    **æ™‚é–“**

    - ç¢ºèªä¸€å‰‡ â†’ O(log(n))
- åœ–è³‡æ–™åº«
    - æ¯å€‹ user ä¸€å€‹ nodeï¼Œæ¯å€‹çŸ­ç‰‡ä¸€å€‹ nodeã€‚
    - graph database

        ![Bloom%20Filter%20472b644394414c3691c8cd8ac6454bf6/Untitled.png](Bloom%20Filter%20472b644394414c3691c8cd8ac6454bf6/Untitled.png)

    **æ™‚é–“**

    æˆ‘ä¹Ÿä¸çŸ¥é“æ€éº¼ç®—ï¼Œä½†ç¸½ä¹‹ > O(1)ã€‚

- Bloom filter

    æ¯å€‹ user ä¸€å€‹ hash è¡¨ï¼Œå„²å­˜ 0 / 1ã€‚

    **æ™‚é–“**

    - O(1)

# Bloom Filter

æœ‰é»é¡ä¼¼é›†åˆï¼Œå¸¸ç”¨æ–¼å¿«é€Ÿæª¢æŸ¥ä¸€å€‹å…ƒç´ æ˜¯å¦ã€Œå¯èƒ½å­˜åœ¨ã€æˆ–ã€Œçµ•å°ä¸å­˜åœ¨ã€æ–¼å®¹å™¨ä¸­ã€‚å³æœƒå‡ºç¾å‡é™½æ€§ï¼Œä½†ä¸æœƒæœ‰å‡é™°æ€§ã€‚

**å„ªé»**

- é¡ä¼¼[é›†åˆ](https://rust-algo.club/collections/set)ï¼Œå¯åœ¨Â O(1)Â æ™‚é–“è¤‡é›œåº¦é©—è­‰æˆå“¡æ˜¯å¦å­˜åœ¨ï¼Œå»åƒ…éœ€ç›¸å°å°‘çš„å„²å­˜ç©ºé–“ã€‚
- æ‰¿ä¸Šï¼Œ[åœ¨ 0.1% éŒ¯èª¤ç‡ä¸‹å„²å­˜ä¸€ç™¾è¬å€‹å…ƒç´ åƒ…éœ€ 1.71 MiB](https://hur.st/bloomfilter/?n=1M&p=0.001&m=&k=)ã€‚
- éå¸¸å®¹æ˜“å¯¦ä½œçš„æ©Ÿç‡è³‡æ–™çµæ§‹ï¼Œåƒ…éœ€å¤šæ¬¡é›œæ¹Šã€‚

**ç¼ºé»**

- åŸç‰ˆ Bloom filter å®¹å™¨å¤§å°å›ºå®šï¼ˆfixed-sizeï¼‰ï¼Œç„¡æ³•å‹•æ…‹èª¿æ•´å„²å­˜ç©ºé–“ï¼ˆå¯é€é[è®Šå½¢](https://rust-algo.club/collections/bloom_filter/#%E8%AE%8A%E5%BD%A2)è§£æ±ºï¼‰ã€‚
- å¯èƒ½çµ¦å‡ºå‡é™½æ€§ç­”æ¡ˆï¼šå›å ±å­˜åœ¨ä½†å¯¦éš›ä¸å­˜åœ¨ï¼Œä¸”éŒ¯èª¤éš¨æ•¸é‡è®Šå¤šä¸Šå‡ã€‚
- è‡ªèº«ä¸å„²å­˜æˆå“¡è³‡æ–™ï¼Œéœ€è¦æœ‰é¡å¤–çš„å„²å­˜è³‡æ–™æ–¹æ¡ˆã€‚
- åªèƒ½æ–°å¢æˆå“¡ï¼Œä½†ä¸èƒ½ç§»é™¤æˆå“¡ï¼ˆå¯é€é[è®Šå½¢](https://rust-algo.club/collections/bloom_filter/#%E8%AE%8A%E5%BD%A2)è§£æ±ºï¼‰ã€‚

### çµ„æˆå…ƒç´ 

- m ä½å…ƒçš„ä½å…ƒé™£åˆ—
- k å€‹ hash function

### æ“ä½œ

**æ’å…¥**

çµ¦å®šä¸€å€‹ keyï¼Œåˆ©ç”¨ k å€‹ hash function è¨ˆç®—å‡º k å€‹ hash å€¼ï¼Œå°‡é™£åˆ—ä¸­çš„ k å€‹ä½ç½®è¨­ç‚º trueã€‚

**æŸ¥è©¢**

çµ¦å®šä¸€å€‹ keyï¼Œåˆ©ç”¨ k å€‹ hash function è¨ˆç®—å‡º k å€‹ hash å€¼ï¼Œæª¢æŸ¥ k å€‹ä½ç½®ï¼Œè‹¥çš†ç‚º trueï¼Œå‰‡ key å­˜åœ¨ã€‚

![Bloom%20Filter%20472b644394414c3691c8cd8ac6454bf6/Untitled%201.png](Bloom%20Filter%20472b644394414c3691c8cd8ac6454bf6/Untitled%201.png)

ä¸Šåœ–é¡¯ç¤º w ä¸¦æ²’æœ‰åœ¨ {x,y,z} é›†åˆä¸­ï¼Œå› ç‚º w çš„é›œæ¹Šçµæœæœ‰å€‹ä½å…ƒç‚º 0

### å•é¡Œ

- ç‚ºä»€éº¼ä¸ç›´æ¥ä½¿ç”¨ hash tableï¼ˆk=1ï¼‰å°±å¥½ï¼Ÿ

    ä½¿ç”¨å¤šå€‹ hash function ä»¥æ¸›å°‘ç¢°æ’ç™¼ç”Ÿã€‚

    ![Bloom%20Filter%20472b644394414c3691c8cd8ac6454bf6/Untitled%202.png](Bloom%20Filter%20472b644394414c3691c8cd8ac6454bf6/Untitled%202.png)

- èª¤åˆ¤çš„æ©Ÿç‡æ˜¯å¤šå°‘ï¼Ÿå¯ä»¥èª¿æ•´å—ï¼Ÿ

    å›ç­”é€™äº›å•é¡Œéœ€è¦å…©å€‹å·²çŸ¥æ¢ä»¶ï¼š

    1. é æœŸæœƒå„²å­˜ n å€‹å…ƒç´ åˆ°å®¹å™¨ã€‚
    2. å¯å®¹å¿çš„å‡é™½æ€§æ©Ÿç‡Â Ïµã€‚ï¼ˆå³å®¹å™¨ä¸åŒ…å«è©²å…ƒç´ ï¼Œæª¢æ¸¬å»å›å ±å­˜åœ¨ï¼‰

    æ–¼æ˜¯å¯å¾—ä½å…ƒé™£åˆ—æœ€ä½³åŒ–çš„é•·åº¦ç‚ºÂ mÂ å€‹ä½å…ƒï¼ŒmÂ ç‚ºï¼š

    $$m = -\frac{nln(\epsilon)}{(ln2)^2}$$

    è€Œåœ¨å·²çŸ¥æ¢ä»¶ä¸‹ï¼Œéœ€è¦çš„é›œæ¹Šå‡½æ•¸æ•¸é‡Â kÂ ç‚ºï¼š

    $$k = - \frac{ln(\epsilon)}{ln(2)} = - log_2(\epsilon)$$

- éœ€è¦å¤šå€‹ä¸åŒçš„ hash functionï¼Ÿ

    double hashing â†’ hash open addressing 

    é€™ç¯‡ã€Œ[Less Hashing, Same Performance:Building a Better Bloom Filter](https://www.eecs.harvard.edu/~michaelm/postscripts/rsa2008.pdf)ã€æåŠï¼Œåœ¨ä¸çŠ§ç‰²æ¼¸é€²å‡é™½æ€§æ©Ÿç‡ï¼ˆasymptotic false positive probabilityï¼‰çš„å‰æä¸‹ï¼Œé€éå…©å€‹ä¸åŒçš„é›œæ¹Šå‡½æ•¸ $h_1(x)$ å’Œ $h_2(x)$ï¼Œé…åˆä»¥ä¸‹å…¬å¼ï¼Œå°±å¯ä»¥æ¨¡æ“¬å‡ºå¤šå€‹é›œæ¹Šå‡½æ•¸ï¼š

    $$g_i = h_1(x) + ih_2(x)$$

hash â†’ çµ¦å®š x (h(x) â†’ key)ï¼Œ O(1) æ‰¾åˆ°å°æ‡‰çš„ value

x â†’ h(x) â†’ hash table[h(x)] = y

### ä½¿ç”¨æƒ…æ³

èƒ½å…è¨±å‡é™½æ€§ï¼ˆFalse Positiveï¼‰çš„æƒ…æ³ç™¼ç”Ÿã€‚

- What is å‡é™½æ€§ / å‡é™°æ€§ï¼Ÿ

    **Confusion matrix**

    - çœŸé™½æ€§ï¼ˆTrue Positiveï¼‰
    - çœŸé™°æ€§ï¼ˆTrue Negativeï¼‰
    - å‡é™½æ€§ï¼ˆFalse Positiveï¼‰
    - å‡é™°æ€§ï¼ˆFalse Negativeï¼‰

    ![Bloom%20Filter%20472b644394414c3691c8cd8ac6454bf6/Untitled%203.png](Bloom%20Filter%20472b644394414c3691c8cd8ac6454bf6/Untitled%203.png)

**Example**

- é¿å…æ¨è–¦å·²çœ‹éçš„å½±ç‰‡ã€æ–‡ç« 
- é©—è­‰å¤§é‡æƒ¡æ„é€£çµ

## è®Šå½¢

**[å‹•æ…‹é©æ‡‰ç©ºé–“å¤§å°çš„ Scalable Bloom Filter](https://rust-algo.club/collections/bloom_filter/#%E5%8B%95%E6%85%8B%E9%81%A9%E6%87%89%E7%A9%BA%E9%96%93%E5%A4%A7%E5%B0%8F%E7%9A%84-scalable-bloom-filter)**

[ğŸ“š è«–æ–‡é€£çµ](https://gsd.di.uminho.pt/members/cbm/ps/dbloom.pdf)

**ç‰¹è‰²**ï¼šå‹•æ…‹é©æ‡‰ç©ºé–“å¤§å°ï¼Œä¸éœ€äº‹å…ˆçŸ¥é“é æœŸå„²å­˜çš„å…ƒç´ å€‹æ•¸ã€‚

**çµ„æˆ**ï¼šç”±ä¸€è‡³å¤šå€‹ç¶“å…¸æ¬¾ Bloom filter çµ„æˆã€‚

**æ’å…¥**ï¼š

è‹¥ä¸€å€‹ filter å¿«æ»¿äº†ï¼ˆè¶…é fill ratioï¼‰ï¼Œå‰‡æœƒæ–°å¢ä¸€å€‹æ›´å¤§çš„ filterï¼Œå¾€å¾Œæ‰€æœ‰æ–°å¢éƒ½åœ¨é€™å€‹æ–° filter ä¸Šé¢ï¼Œç›´åˆ°å®ƒä¹Ÿæ»¿äº†å°±å†æ–°å¢ä¸€å€‹ã€‚

**æŸ¥è©¢**ï¼š

Scalable Bloom Filter æ¯”è¼ƒå¼±çš„åœ°æ–¹ï¼ŒæŸ¥è©¢æœƒå¾ç¬¬ä¸€å€‹ filter é–‹å§‹æ‰¾ï¼Œè‹¥æ‰¾ä¸åˆ°å¾€ä¸‹ä¸€å€‹ filter æ‰¾ï¼Œæ‰¾åˆ°æœƒæ²’æœ‰ä¸‹ä¸€å€‹ filter ç‚ºæ­¢ã€‚è‹¥ filter æ•¸é‡ç‚º $l$ï¼Œå‰‡æŸ¥è©¢çš„æ™‚é–“è¤‡é›œåº¦å¾Â $O(k)$Â è®ŠæˆÂ $O(k*l)$ã€‚

### å»¶ä¼¸ Topic

- [Quotient filter](https://rust-algo.club/collections/bloom_filter/#quotient-filter)
- [æ”¯æ´åˆªé™¤å…ƒç´ çš„ Cuckoo filter](https://rust-algo.club/collections/bloom_filter/#%E6%94%AF%E6%8F%B4%E5%88%AA%E9%99%A4%E5%85%83%E7%B4%A0%E7%9A%84-cuckoo-filter)

### Reference

**Great Source & å»¶ä¼¸é–±è®€**

[Rust Algorithm Club](https://rust-algo.club/collections/bloom_filter/)

**Topic å•Ÿç™¼é»**

[çˆ²ä»€éº¼æŠ–éŸ³å¾ä¾†æ²’æœ‰é‡è¤‡å…§å®¹ï¼Ÿç„¡é—œè³‡æ–™åº«ï¼ŒèƒŒå¾Œçš„æ¼”ç®—æ³•æœ‰å¤§å­¸å•](https://medium.com/%E6%95%B8%E6%93%9A%E5%88%86%E6%9E%90%E4%B8%8D%E6%98%AF%E5%80%8B%E4%BA%8B/%E7%88%B2%E4%BB%80%E9%BA%BC%E6%8A%96%E9%9F%B3%E5%BE%9E%E4%BE%86%E6%B2%92%E6%9C%89%E9%87%8D%E8%A4%87%E5%85%A7%E5%AE%B9-%E7%84%A1%E9%97%9C%E8%B3%87%E6%96%99%E5%BA%AB-%E8%83%8C%E5%BE%8C%E7%9A%84%E6%BC%94%E7%AE%97%E6%B3%95%E6%9C%89%E5%A4%A7%E5%AD%B8%E5%95%8F-97c7c3f1c417)